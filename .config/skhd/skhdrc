.define yabai_focus : yabai -m config mouse_follows_focus on && yabai -m window --focus {{1}} || yabai -m display --focus {{1}} && yabai -m config mouse_follows_focus off
.define yabai_swap : yabai -m window --swap {{1}} || (yabai -m window --display {{1}} && yabai -m display --focus {{1}})
.define toggle_app : open -a "{{1}}" || osascript -e 'tell app "{{1}}" to quit'
.define toggle_space_layout: yabai -m space --layout $([ "$(yabai -m query --spaces --space | jq -r '.type')" = "stack" ] && echo "bsp" || echo "stack")
.define resize_window : yabai -m window --resize {{1}}:{{2}}:{{3}}
.define toggle_scratchpad : yabai -m window --toggle {{1}} || open -a "{{2}}"
.define focus_app : nu "~/.config/yabai/focus_app_command.nu" "{{1}}"
.define toggle_pip_visibility : yabai -m query --windows --window | jq -r '.id' | xargs -I {} sh -c 'yabai -m window --toggle videos && yabai -m window --focus {}'
.define send_key_to_app : yabai -m window --focus (yabai -m query --windows | jq -r '.[] | select(.app == "{{1}}") | .id') && skhd --key "{{2}}" && yabai -m window --focus recent

cmd + ctrl + alt - g : nu ~/.config/yabai/toggle_dev_command.nu

# cmd + ctrl + alt - s : show passwords (defined in 1password)
# cmd + ctrl + alt - y : show clipboard history (defined in raycast)
# cmd + ctrl + alt - enter : add task (defined in ticktick)
cmd + ctrl + alt - b : @focus_app("Reader")

cmd + ctrl + alt - t : @focus_app("kitty")
cmd + ctrl + alt - e : @focus_app("Cursor")
cmd + ctrl + alt - i : @focus_app("Arc")
cmd + ctrl + alt - c : @focus_app("Microsoft Teams")
cmd + ctrl + alt - d : @focus_app("Discord")

cmd + ctrl + alt - j : @focus_app("Messenger")

cmd + ctrl + alt - u : shortcuts run "PlayPause"
cmd + ctrl + alt - m : @toggle_scratchpad("music", "Spotify")
cmd + ctrl + alt - space : nu "~/.config/yabai/fix_raycast.nu" || skhd --key "cmd + ctrl + alt + shift - space" 
# '
cmd + ctrl + alt - 0x27 : @send_key_to_app("Reader", "pagedown")
# "
cmd + ctrl + alt + shift - 0x27 : @send_key_to_app("Reader", "pageup")

cmd + ctrl + alt - v : @toggle_pip_visibility()

# move to window mode?
cmd + ctrl + alt - q : yabai --restart-service || yabai --start-service
cmd + ctrl + alt + shift - q : yabai --stop-service

# how to deminimize sometimes not visible windows?

cmd + ctrl + alt - p : @yabai_focus("recent")
cmd + ctrl + alt - n : @yabai_focus("west")
cmd + ctrl + alt - o : @yabai_focus("east")
# support qwerty
cmd + ctrl + alt - h : @yabai_focus("west")
cmd + ctrl + alt - l : @yabai_focus("east")

# ,
cmd + ctrl + alt - 0x2B : yabai -m window --focus stack.next || yabai -m window --focus stack.first  # Navigate stack next
# .
cmd + ctrl + alt - 0x2F : yabai -m window --focus stack.prev || yabai -m window --focus stack.last  # Navigate stack prev

# r and f are free bindings
# maybe r can raise a layer
# cmd + ctrl + alt - f : yabai -m window --toggle zoom-fullscreen

# WINDOW MANAGEMENT
:: winmode @ : echo -n "red" | nc -4u -w0 localhost 1738
:: default : echo -n "hollow" | nc -4u -w0 localhost 1738

cmd + ctrl + alt - w ; winmode

winmode < escape ; default
winmode < cmd + ctrl + alt - w ; default

# make fullscreen
# yabai -m window --toggle zoom-fullscreen

winmode < m : @toggle_space_layout()
winmode < f : yabai -m window --toggle zoom-fullscreen
winmode < d : yabai -m window --deminimize

winmode < n : yabai -m window --focus west || yabai -m display --focus west
winmode < e : yabai -m window --focus south || yabai -m display --focus south
winmode < i : yabai -m window --focus north || yabai -m display --focus north
winmode < o : yabai -m window --focus east || yabai -m display --focus east

winmode < ctrl + alt - n : yabai -m window --resize left:-20:0
winmode < ctrl + alt - e : yabai -m window --resize bottom:0:20
winmode < ctrl + alt - i : yabai -m window --resize top:0:-20
winmode < ctrl + alt - o : yabai -m window --resize right:20:0

winmode < cmd + ctrl + alt - n : yabai -m window --display west --focus
winmode < cmd + ctrl + alt - o : yabai -m window --display east --focus

winmode < shift - n : yabai -m window --warp west
winmode < shift - e : yabai -m window --warp south
winmode < shift - i : yabai -m window --warp north
winmode < shift - o : yabai -m window --warp east

winmode < ctrl + shift - n : yabai -m window --stack west
winmode < ctrl + shift - e : yabai -m window --stack south
winmode < ctrl + shift - i : yabai -m window --stack north
winmode < ctrl + shift - o : yabai -m window --stack east

winmode < s : yabai -m window --insert stack  # Toggle stack mode
winmode < u : yabai -m window --toggle float; yabai -m window --toggle float  # Unstack window

# ,
winmode < 0x2B : yabai -m window --focus stack.next || yabai -m window --focus stack.first
# .
winmode < 0x2F : yabai -m window --focus stack.prev || yabai -m window --focus stack.last

# winmode < r ; resize
# :: resize @ : echo -n "orange" | nc -4u -w0 localhost 1738
# resize < ctrl + alt - n : yabai -m window --resize left:-20:0
# resize < ctrl + alt - e : yabai -m window --resize bottom:0:20
# resize < ctrl + alt - i : yabai -m window --resize top:0:-20
# resize < ctrl + alt - o : yabai -m window --resize right:20:0
# resize < escape ; winmode

